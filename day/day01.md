# day 01

## PC 구조, Assembly 입문

'hello, World' 를 출력하는 binary, assembly 코드를 작성한다.

플로피디스크에 설치하여 부팅하는 방법과 에뮬레이터(QEMU) 를 사용하는 2가지 방법을 제공한다.  
하드웨어의 발전, 변화로 플로피디스크 설치 방식은 어렵기 때문에 에뮬레이터 방식을 사용한다.

## 플로피디스크

- 플로피디스크 용량 1440KB (1474560byte) (16800Hex byte)
- 플로피디스크는 512byte 단위로 읽고 쓴다. (1섹터)
- 실행시 첫 섹터(부트섹터)의 마지막 2byte가 '55 AA' 일 경우 부팅 가능하다고 판단한다.

## Assembly

assembler는 저자가 개발한 nask를 사용한다.

```
DB   : data byte - 1byte 쓰기
RESB : reserve byte - n 만큼 띄운다. (nask에서는 0x00으로 채운다.)
DW   : data word - 2byte
DD   : data double word - 4byte
```

## helloos0

(책에서 소개하는 바이너리 에디터 다운로드는 불가능한 상태여서 vscode의 Hex Editor 사용하였다.)

![binary](../images/day01_binary.png)

## helloos1

```asm
	DB	0xeb, 0x4e, 0x90, 0x48, 0x45, 0x4c, 0x4c, 0x4f
	DB	0x49, 0x50, 0x4c, 0x00, 0x02, 0x01, 0x01, 0x00
	DB	0x02, 0xe0, 0x00, 0x40, 0x0b, 0xf0, 0x09, 0x00
	DB	0x12, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00
	DB	0x40, 0x0b, 0x00, 0x00, 0x00, 0x00, 0x29, 0xff
	DB	0xff, 0xff, 0xff, 0x48, 0x45, 0x4c, 0x4c, 0x4f
	DB	0x2d, 0x4f, 0x53, 0x20, 0x20, 0x20, 0x46, 0x41
	DB	0x54, 0x31, 0x32, 0x20, 0x20, 0x20, 0x00, 0x00
	RESB	16
	DB	0xb8, 0x00, 0x00, 0x8e, 0xd0, 0xbc, 0x00, 0x7c
	DB	0x8e, 0xd8, 0x8e, 0xc0, 0xbe, 0x74, 0x7c, 0x8a
	DB	0x04, 0x83, 0xc6, 0x01, 0x3c, 0x00, 0x74, 0x09
	DB	0xb4, 0x0e, 0xbb, 0x0f, 0x00, 0xcd, 0x10, 0xeb
	DB	0xee, 0xf4, 0xeb, 0xfd, 0x0a, 0x0a, 0x68, 0x65
	DB	0x6c, 0x6c, 0x6f, 0x2c, 0x20, 0x77, 0x6f, 0x72
	DB	0x6c, 0x64, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00
	RESB	368
	DB	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x55, 0xaa
	DB	0xf0, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00
	RESB	4600
	DB	0xf0, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00
	RESB	1469432
```

## helloos2

```assembly
; hello-os
; TAB=4

; 이하는 표준적인 FAT12 포맷 플로피 디스크를 위한 기술

		DB		0xeb, 0x4e, 0x90
		DB		"HELLOIPL"	; boot sector의 이름은 자유롭게 써도 좋다(8바이트)
		DW		512		; 1섹터의 크기(512로 해야 함)
		DB		1		; 클러스터의 크기(1섹터로 해야 함)
		DW		1		; FAT가 어디에서 시작될까(보통은 1섹터째부터)
		DB		2		; FAT의 개수(2로 해야 함)
		DW		224		; 루트 디렉토리 영역의 크기(보통은 224엔트리로 한다)
		DW		2880		; 드라이브 크기(2880섹터 해야 함)
		DB		0xf0		; 미디어 타입(0xf0해야 함
		DW		9		; FAT영역 길이(9섹터로 해야 함)
		DW		18		; 1트럭에 몇개의 섹터가 있을까(18로 해야 함)
		DW		2		; 헤드 수(2로 해야 함)
		DD		0		; 파티션을 사용하지 않기 때문에 여기는 반드시 0
		DD		2880		; 드라이브 크기를 한번 더 write
		DB		0,0,0x29	; 잘 모르지만 이 값으로 해 두면 좋은 것 같다
		DD		0xffffffff	; 아마, 볼륨 시리얼 번호
		DB		"HELLO-OS   "	; 디스크 이름(11바이트)
		DB		"FAT12   "	; 포맷 이름(8바이트)
		RESB	18			; 우선 18바이트를 비어둔다

; 프로그램 본체

		DB		0xb8, 0x00, 0x00, 0x8e, 0xd0, 0xbc, 0x00, 0x7c
		DB		0x8e, 0xd8, 0x8e, 0xc0, 0xbe, 0x74, 0x7c, 0x8a
		DB		0x04, 0x83, 0xc6, 0x01, 0x3c, 0x00, 0x74, 0x09
		DB		0xb4, 0x0e, 0xbb, 0x0f, 0x00, 0xcd, 0x10, 0xeb
		DB		0xee, 0xf4, 0xeb, 0xfd

; 메세지 부분

		DB		0x0a, 0x0a		; 개행을 2개
		DB		"hello, world"
		DB		0x0a			; 개행
		DB		0

		RESB	0x1fe-$				; 0 x001fe까지를 0x00로 채우는 명령
		                            ; 510(1fe) - 선두로 부터 byte 수($)

		DB		0x55, 0xaa

; 이하는 boot sector이외의 부분을 기술

		DB		0xf0, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00
		RESB	4600
		DB		0xf0, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00
		RESB	1469432
```
